// ignore_for_file: prefer_const_constructors, unnecessary_null_comparison

import 'package:flutter/material.dart';
import 'package:math_expressions/math_expressions.dart';

class Calculator extends StatefulWidget {
  const Calculator({Key? key}) : super(key: key);

  @override
  State<Calculator> createState() => _CalculatorState();
}

class _CalculatorState extends State<Calculator> {
  String userInput = '';
  String result = '';
  final buttonlist = [
    'C',
    '(',
    ')',
    '/',
    '7',
    '8',
    '9',
    '*',
    '4',
    '5',
    '6',
    '+',
    '1',
    '2',
    '3',
    '-',
    'AC',
    '0',
    '.',
    '=',
  ];

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Color(0xFF092134),
      body: SafeArea(
          child: Column(
        mainAxisAlignment: MainAxisAlignment.end,
        children: [
          Flexible(flex: 2, child: resultwidget()),
          Expanded(
            flex: 4,
            child: buttonwidget(),
          ),
        ],
      )),
    );
  }

  resultwidget() {
    return Column(
      mainAxisAlignment: MainAxisAlignment.spaceAround,
      mainAxisSize: MainAxisSize.max,
      children: [
        Container(
          alignment: Alignment.centerRight,
          child: Text(
            userInput,
            style: TextStyle(
                fontSize: 49, color: Colors.white, fontWeight: FontWeight.bold),
          ),
        )
      ],
    );
  }

  buttonwidget() {
    return GridView.builder(
        itemCount: buttonlist.length,
        gridDelegate:
            SliverGridDelegateWithFixedCrossAxisCount(crossAxisCount: 4),
        itemBuilder: (ctx, index) {
          return buttons(buttonlist[index]);
        });
  }

  buttons(String text) {
    return Container(
      margin: EdgeInsets.all(5),
      child: ElevatedButton(
        onPressed: () {
          handlebuttonpress(text);
        },
        style: ElevatedButton.styleFrom(
            shape: CircleBorder(),
            elevation: 5,
            primary: Colors.purple.shade900),
        child: Text(
          text,
          style: TextStyle(fontSize: 30, color: Colors.white),
        ),
      ),
    );
  }

  handlebuttonpress(String text) {
    userInput += text;
    if (text == 'AC') {
      result = '0';
      userInput = '';
    } else if (text == 'C') {
      result = '0';
      if (userInput != null) {
        userInput = userInput.substring(0, userInput.length - 1);
      } else {
        userInput = '';
      }
    } else if (text == '=') {
      result = calculate();
    }
  }

  calculate() {
    try {
      var exp = Parser().parse(userInput);
    } catch (e) {
      print(e);
    }
  }
}
